<html>
  <head>
    <script src="../lib/jquery.js"></script>
    <script src="../dist/Bacon.js"></script>
    <script>
      $(function() {
        function isEmpty(s) { return s.length == 0 }

        function always(value) { return function() { return value }}
        
        function keyCodeIs(keyCode) { 
          return function(event) { return event.keyCode == keyCode }
        }

        function keyDownEvents(keyCode) { 
          return $(document).asEventStream("keydown").filter(keyCodeIs(keyCode))
        }

        function keyUpEvents(keyCode) { 
          return $(document).asEventStream("keyup").filter(keyCodeIs(keyCode))
        }

        function keyStateProperty(keyCode) { 
          return keyDownEvents(keyCode).map(always("DOWN"))
            .merge(keyUpEvents(keyCode).map(always("UP")))
            .toProperty("UP")
        }

        $("#clikme")
          .asEventStream("click")
          .subscribe(function(event) { alert("mmmm... bacon!") })

        keyStateProperty(32)
          .onValue(function(value) { $("#spacebar-value").text(value) })

        $("#enabling input")
          .asEventStream("keyup")
          .map(function(event) { return $(event.target).val() })
          .toProperty("")
          .map(isEmpty)
          .assign($("#enabling button"), "attr", "disabled")

        $("#echo input")
          .asEventStream("keyup")
          .map(function(event) { return $(event.target).val() })
          .toProperty("")
          .assign($("#echo .output"), "text")

        function calculate(expr, entry) {
          function isOperator (c) {
            return c === '/' || c === '*' || c === '-' || c === '+'
          }
          if (entry === 'C') return '0'
          if (entry === '=') {
            try {
              var evaldExpr = eval(expr)
            } catch (e) {
              if (e instanceof SyntaxError) return "ERROR"
              throw e
            }
            if (expr === "ERROR") return "ERROR"
            return isFinite(evaldExpr) ? String(evaldExpr) : "ERROR"
          }
          if (expr === "ERROR") return calculate('0', entry)
          if (expr === '0' && !isOperator(entry)) return entry
          return expr.concat(entry)
        }

        $("#calculator button")
          .asEventStream("click")
          .map(function(e) { return $(e.target).text() })
          .scan('0', calculate)
          .assign($("#calculator .result"), "text")
      })
    </script>
  </head>
  <body>
    <h1>bacon.js example page</h1>
    <div>
      <h2>Simplest example:</h2>
      <span id="clikme">click me</span>
    </div>
    <div>
      <h2>Combinators example:</h2>
      SPACEBAR value=<span id="spacebar-value"></span>
    </div>
    <div id="enabling">
      <h2>Enable/disable example:</h2>
      <input type="text" placeholder="required field">
      <button>Don't push me</button>
    </div>
    <div id="echo">
      <h2>Echo example:</h2>
      <input type="text">
      <span class="output"></span>
    </div>
    <div id="calculator">
      <h2>Calculator example:</h2>
      <table>
        <tr>
          <td class="result" colspan="3"></td>
          <td><button>C</button></td>
        </tr>
        <tr>
          <td><button>7</button></td>
          <td><button>8</button></td>
          <td><button>9</button></td>
          <td><button>/</button></td>
        </tr>
        <tr>
          <td><button>4</button></td>
          <td><button>5</button></td>
          <td><button>6</button></td>
          <td><button>*</button></td>
        </tr>
        <tr>
          <td><button>1</button></td>
          <td><button>2</button></td>
          <td><button>3</button></td>
          <td><button>-</button></td>
        </tr>
        <tr>
          <td><button>0</button></td>
          <td><button>.</button></td>
          <td><button>=</button></td>
          <td><button>+</button></td>
        </tr>
      </table>
    </div>
  </body>
</html>
